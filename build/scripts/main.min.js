var kenticoData=null,kenticoSaveValue=function(e){},kenticoResizeIframe=function(e){};!function(){try{if(!CustomElement)return;CustomElement.init(function(e,t){console.log("element",e),kenticoData=JSON.parse(e.value);e.config}),kenticoSaveValue=function(e){CustomElement.setValue(e),console.log("set value to",e)},kenticoResizeIframe=function(e){CustomElement.setHeight(e)}}catch(e){"Custom element is not hosted in an IFrame"==e.message?console.warn("This image editor is currently not hosted in the correct Kentico Cloud environment."):console.warn("Something went wrong in the Kentico image editor element.\n\n",e)}}();var inputContainer=document.querySelector(".js-inputs"),area=document.querySelector(".js-mouse-leave-drop");function setInitialValues(){if(kenticoData){console.log("data",kenticoData);for(var e=0;e<kenticoData.images.length;e++){var t=kenticoData.images[e],n=document.createElement("img");n.className="js-movable-image",n.src="assets/grocery.svg",n.style.left=t.x,n.style.top=t.y,$(".js-images-container").appendChild(n),console.log("added image",n)}}}function registerImage(e){var t=getUniqueId(e);e.setAttribute("data-id",t),bindEvents(t),addListeners(t)}function getUniqueId(){for(var e=1;inputContainer.querySelector('input[data-id="'+e+'"]');)e++;return e}function bindEvents(e){var t=area.querySelector('img[data-id="'+e+'"]'),n=document.createElement("input");n.setAttribute("data-id",e),n.classList.add("js-submit-x"),n.classList.add("js-write-x"),n.classList.add("js-read-x"),n.value=area.offsetWidth/2,inputContainer.appendChild(n),n.addEventListener("change",function(){repositionImageX(n.value,t,n)});var a=document.createElement("input");a.setAttribute("data-id",e),a.classList.add("js-submit-y"),a.classList.add("js-write-y"),a.classList.add("js-read-y"),a.value=area.offsetHeight/2,inputContainer.appendChild(a),a.addEventListener("change",function(){repositionImageY(a.value,t,a)})}function addListeners(t){var n=area.querySelector('img[data-id="'+t+'"]');n.addEventListener("mousedown",function(e){n.setAttribute("data-holding",!0),repositionImageToCursor(e,t)}),area.addEventListener("mousemove",function(e){n.getAttribute("data-holding")&&repositionImageToCursor(e,t)}),area.addEventListener("mouseup",function(e){n.getAttribute("data-holding")&&(n.setAttribute("data-holding",""),repositionImageToCursor(e,t))}),area.addEventListener("mouseleave",function(e){n.getAttribute("data-holding")&&(n.setAttribute("data-holding",""),repositionImageToCursor(e,t))})}function repositionImageToCursor(e,t){var n=document.querySelector(".js-images-container").getBoundingClientRect(),a=Math.round(e.clientX-n.left),i=Math.round(e.clientY-n.top),o=area.querySelector('img[data-id="'+t+'"]'),r=inputContainer.querySelector('input.js-write-x[data-id="'+t+'"]'),s=inputContainer.querySelector('input.js-write-y[data-id="'+t+'"]');repositionImageX(a,o,r),repositionImageY(i,o,s)}function repositionImageX(e,t,n){e<0&&(e=0),e>area.offsetWidth&&(e=area.offsetWidth),t&&(t.style.left=e+"px"),n&&(n.value=e)}function repositionImageY(e,t,n){e<0&&(e=0),e>area.offsetHeight&&(e=area.offsetHeight),t&&(t.style.top=e+"px"),n&&(n.value=e),translateInputsToJson()}function translateInputsToJson(){for(var e={images:[]},t=document.querySelectorAll(".js-read-x"),n=0;n<t.length;n++){var a=t[n],i=a.getAttribute("data-id"),o=document.querySelector('.js-read-y[data-id="'+i+'"]'),r={x:a.value,y:o.value};r.x&&r.y?e.images.push(r):alert("One of the inputs was not filled properly.")}insertJsonInResult(e)}function insertJsonInResult(e){console.log("saving...",e),document.querySelector(".js-output").value=JSON.stringify(e),kenticoSaveValue(JSON.stringify(e))}!function(){kenticoResizeIframe(600),setInitialValues();for(var e=document.querySelectorAll(".js-movable-image"),t=0;t<e.length;t++)registerImage(e[t]);translateInputsToJson()}();