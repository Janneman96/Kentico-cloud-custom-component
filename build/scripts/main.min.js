var kenticoData=null,kenticoSaveValue=function(e){},kenticoResizeIframe=function(e){};!function(){try{if(!CustomElement)return;CustomElement.init(function(e,t){console.log("kentico element",e),kenticoData=JSON.parse(e.value),console.log("kentico data",kenticoData);JSON.parse(e.config)}),kenticoSaveValue=function(e){CustomElement.setValue(e)},kenticoResizeIframe=function(e){CustomElement.setHeight(e)}}catch(e){"Custom element is not hosted in an IFrame"==e.message?console.warn("This image editor is currently not hosted in the correct Kentico Cloud environment."):console.warn("Something went wrong in the Kentico image editor element.\n\n",e)}}();var inputContainer=document.querySelector(".js-inputs"),area=document.querySelector(".js-mouse-leave-drop");function getImages(){if(!kenticoData||!kenticoData.images.length)return document.querySelectorAll(".js-movable-image");for(var e=[],t=0;t<images.length;t++){var n=images[t],a=document.createElement("img");a.className="js-movable-image",a.src="assets/grocery.svg",a.style.left=n.x,a.style.top=n.y,a.setAttribute("data-position-left",n.x),a.setAttribute("data-position-top",n.y),e.push(a)}return e}function registerImage(e){var t=getUniqueId(e);e.setAttribute("data-id",t),bindEvents(e),addListeners(t)}function getUniqueId(){for(var e=1;inputContainer.querySelector('input[data-id="'+e+'"]');)e++;return e}function bindEvents(e){var t=e.getAttribute("data-id"),n=document.createElement("input");n.setAttribute("data-id",t),n.classList.add("js-submit-x"),n.classList.add("js-write-x"),n.classList.add("js-read-x");var a=parseInt(e.getAttribute("data-position-left"))||area.offsetWidth/2;n.value=a,e.style.left=a,inputContainer.appendChild(n),n.addEventListener("change",function(){repositionImageX(n.value,e,n)});var i=document.createElement("input");i.setAttribute("data-id",t),i.classList.add("js-submit-y"),i.classList.add("js-write-y"),i.classList.add("js-read-y");var o=parseInt(e.getAttribute("data-position-top"))||area.offsetHeight/2;i.value=o,e.style.top=o,i.value||(i.value=area.offsetHeight/2,e.style.top=area.offsetHeight/2),inputContainer.appendChild(i),i.addEventListener("change",function(){repositionImageY(i.value,e,i)})}function addListeners(t){var n=area.querySelector('img[data-id="'+t+'"]');n.addEventListener("mousedown",function(e){n.setAttribute("data-holding",!0),repositionImageToCursor(e,t)}),area.addEventListener("mousemove",function(e){n.getAttribute("data-holding")&&repositionImageToCursor(e,t)}),area.addEventListener("mouseup",function(e){n.getAttribute("data-holding")&&(n.setAttribute("data-holding",""),repositionImageToCursor(e,t))}),area.addEventListener("mouseleave",function(e){n.getAttribute("data-holding")&&(n.setAttribute("data-holding",""),repositionImageToCursor(e,t))})}function repositionImageToCursor(e,t){var n=document.querySelector(".js-images-container").getBoundingClientRect(),a=Math.round(e.clientX-n.left),i=Math.round(e.clientY-n.top),o=area.querySelector('img[data-id="'+t+'"]'),r=inputContainer.querySelector('input.js-write-x[data-id="'+t+'"]'),s=inputContainer.querySelector('input.js-write-y[data-id="'+t+'"]');repositionImageX(a,o,r),repositionImageY(i,o,s)}function repositionImageX(e,t,n){e<0&&(e=0),e>area.offsetWidth&&(e=area.offsetWidth),t&&(t.style.left=e+"px"),n&&(n.value=e)}function repositionImageY(e,t,n){e<0&&(e=0),e>area.offsetHeight&&(e=area.offsetHeight),t&&(t.style.top=e+"px"),n&&(n.value=e),translateInputsToJson()}function translateInputsToJson(){for(var e={images:[]},t=document.querySelectorAll(".js-read-x"),n=!1,a=0;a<t.length;a++){var i=t[a],o=i.getAttribute("data-id"),r=document.querySelector('.js-read-y[data-id="'+o+'"]'),s={x:i.value,y:r.value};s.x&&s.y?e.images.push(s):n=!0}n&&alert("One of the inputs was not filled properly."),insertJsonInResult(e)}function insertJsonInResult(e){document.querySelector(".js-output").value=JSON.stringify(e),kenticoSaveValue(JSON.stringify(e))}!function(){kenticoResizeIframe(600);for(var e=getImages(),t=0;t<e.length;t++)registerImage(e[t]);translateInputsToJson()}();