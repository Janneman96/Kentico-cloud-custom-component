var kenticoData=null,kenticoSaveValue=function(e){},kenticoResizeIframe=function(e){};!function(){try{if(!CustomElement)return;CustomElement.init(function(e,t){kenticoData=JSON.parse(e.value),console.log("kentico data",kenticoData);JSON.parse(e.config)}),kenticoSaveValue=function(e){CustomElement.setValue(e)},kenticoResizeIframe=function(e){CustomElement.setHeight(e)}}catch(e){"Custom element is not hosted in an IFrame"==e.message?console.warn("This image editor is currently not hosted in the correct Kentico Cloud environment."):console.warn("Something went wrong in the Kentico image editor element.\n\n",e)}}();var inputContainer=document.querySelector(".js-inputs"),area=document.querySelector(".js-mouse-leave-drop");function getImages(){if(!kenticoData||!kenticoData.images.length)return document.querySelectorAll(".js-movable-image");for(var e=[],t=0;t<kenticoData.images.length;t++){var a=kenticoData.images[t],n=document.createElement("img");n.className="js-movable-image",n.src="assets/grocery.svg",n.style.left=a.x,n.style.top=a.y,n.setAttribute("data-position-left",a.x),n.setAttribute("data-position-top",a.y),e.push(n)}return e}function registerImage(e){var t=getUniqueId(e);e.setAttribute("data-id",t),bindEvents(e),addListeners(t)}function getUniqueId(){for(var e=1;inputContainer.querySelector('input[data-id="'+e+'"]');)e++;return e}function bindEvents(e){var t=e.getAttribute("data-id"),a=document.createElement("input");a.setAttribute("data-id",t),a.classList.add("js-submit-x"),a.classList.add("js-write-x"),a.classList.add("js-read-x");var n=parseInt(e.getAttribute("data-position-left"))||area.offsetWidth/2;a.value=n,e.style.left=n,inputContainer.appendChild(a),a.addEventListener("change",function(){repositionImageX(a.value,e,a)});var i=document.createElement("input");i.setAttribute("data-id",t),i.classList.add("js-submit-y"),i.classList.add("js-write-y"),i.classList.add("js-read-y");var o=parseInt(e.getAttribute("data-position-top"))||area.offsetHeight/2;i.value=o,e.style.top=o,i.value||(i.value=area.offsetHeight/2,e.style.top=area.offsetHeight/2),inputContainer.appendChild(i),i.addEventListener("change",function(){repositionImageY(i.value,e,i)})}function addListeners(t){var a=area.querySelector('img[data-id="'+t+'"]');a.addEventListener("mousedown",function(e){a.setAttribute("data-holding",!0),repositionImageToCursor(e,t)}),area.addEventListener("mousemove",function(e){a.getAttribute("data-holding")&&repositionImageToCursor(e,t)}),area.addEventListener("mouseup",function(e){a.getAttribute("data-holding")&&(a.setAttribute("data-holding",""),repositionImageToCursor(e,t))}),area.addEventListener("mouseleave",function(e){a.getAttribute("data-holding")&&(a.setAttribute("data-holding",""),repositionImageToCursor(e,t))})}function repositionImageToCursor(e,t){var a=document.querySelector(".js-images-container").getBoundingClientRect(),n=Math.round(e.clientX-a.left),i=Math.round(e.clientY-a.top),o=area.querySelector('img[data-id="'+t+'"]'),r=inputContainer.querySelector('input.js-write-x[data-id="'+t+'"]'),s=inputContainer.querySelector('input.js-write-y[data-id="'+t+'"]');repositionImageX(n,o,r),repositionImageY(i,o,s)}function repositionImageX(e,t,a){e<0&&(e=0),e>area.offsetWidth&&(e=area.offsetWidth),t&&(t.style.left=e+"px"),a&&(a.value=e)}function repositionImageY(e,t,a){e<0&&(e=0),e>area.offsetHeight&&(e=area.offsetHeight),t&&(t.style.top=e+"px"),a&&(a.value=e),translateInputsToJson()}function translateInputsToJson(){for(var e={images:[]},t=document.querySelectorAll(".js-read-x"),a=!1,n=0;n<t.length;n++){var i=t[n],o=i.getAttribute("data-id"),r=document.querySelector('.js-read-y[data-id="'+o+'"]'),s={x:i.value,y:r.value};s.x&&s.y?e.images.push(s):a=!0}a&&alert("One of the inputs was not filled properly."),insertJsonInResult(e)}function insertJsonInResult(e){document.querySelector(".js-output").value=JSON.stringify(e),kenticoSaveValue(JSON.stringify(e))}!function(){kenticoResizeIframe(600);for(var e=getImages(),t=0;t<e.length;t++)registerImage(e[t]);translateInputsToJson()}();